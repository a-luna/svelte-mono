import type { SvgIconMap } from '$lib/server/types';

export const LOCK_ICON_HTML = '<span class="fa fa-lock"></span>';
export const UNLOCK_ICON_HTML = '<span class="fa fa-unlock-alt"></span>';

export const CODE_FENCE_START_REGEX =
	/```(?<lang>[\w-]+)(?:\s{)?(?:(?<linenos>linenos)=table)?(?:,)?(?:linenostart=(?<start1>[\d]+)|hl_lines=\[(?<highlight1>.+)\])?(?:,)?(?:hl_lines=\[(?<highlight2>.+)\]|linenostart=(?<start2>[\d]+))?(?:})?/g;

export const CODE_FENCE_END_REGEX = /\n```\n/g;
export const INFO_BOX_REGEX = /{{< info_box >}}(?:\s)?(?:<p>)?([\s\S][^{]*)(?:<\/p>)?(?:\s)?{{< \/info_box >}}/g;
export const WARNING_BOX_REGEX = /{{< alert_box >}}(?:\s)?(?:<p>)?([\s\S][^{]*)(?:\s)?(?:<p>)?{{< \/alert_box >}}/g;
export const LINKED_IMAGE_REGEX = /{{< linked_image (?<name>.+) >}}/g;

export const VIDEO_REGEX =
	/{{< autoplay_video video="(?<video>[\w]+)"(?: device="(?<device>mobile|desktop)")?(?: width="(?<width>[\d]+)px")? >}}/g;

export const HTML_HEADING_REGEX = /<h(?<level>2|3|4|5|6) id="(?<slug>[0-9a-z-_]+)">(?<text>.+)<\/(?:h2|h3|h4|h5|h6)>/g;
export const TOX_TEST_RESULTS_REGEX = /test session starts [=]{50,50}([\s\S][^=]*)[=]+/g;

export const CODE_BLOCK_START_REGEX =
	/<pre(?: class="(?<shiki>shiki)" style="background-color: (?<bgColor>#[A-Fa-f0-9]{6,6})")?>?(?:<code(?:>)?)?/g;

export const CODE_BLOCK_END_REGEX = /<\/pre>/g;
export const FA_BULLET_LIST_REGEX = /<div class="fa-bullet-list">/g;

export const FA_BULLET_REGEX =
	/<p class="fa-bullet-list-item(?: complete)?(?: in-progress)?"><span class="fa (?<star>(?:fa-star)(?:-o)?(?:-half-o)?) fa-bullet-icon"><\/span>(?<text>.+)<\/p>/g;

const svgIconMap: SvgIconMap = {
	copy: {
		svg: '<path d="M408 432h-32v32H112V136h32v-32H80v392h328z" /><path d="M176 16v384h320V153.373L358.627 16Zm288 352H208V48h104v152h152Zm0-200H344V48h1.372L464 166.627Z" />',
		height: 512,
	},
	fullStar: {
		svg: '<path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327l4.898.696c.441.062.612.636.282.95l-3.522 3.356l.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />',
		height: 16,
	},
	halfStar: {
		svg: '<path d="M5.354 5.119L7.538.792A.52.52 0 0 1 8 .5c.183 0 .366.097.465.292l2.184 4.327l4.898.696A.54.54 0 0 1 16 6.32a.55.55 0 0 1-.17.445l-3.523 3.356l.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256a.5.5 0 0 1-.146.05c-.342.06-.668-.254-.6-.642l.83-4.73L.173 6.765a.55.55 0 0 1-.172-.403a.6.6 0 0 1 .085-.302a.51.51 0 0 1 .37-.245zM8 12.027a.5.5 0 0 1 .232.056l3.686 1.894l-.694-3.957a.56.56 0 0 1 .162-.505l2.907-2.77l-4.052-.576a.53.53 0 0 1-.393-.288L8.001 2.223L8 2.226z" />',
		height: 16,
	},
	hash: {
		svg: '<path d="M24.01 6.797a1.341 1.341 0 0 0-1.034-.487h-.035h.002h-3.441l.954-4.643A1.4 1.4 0 0 0 20.188.48l.002.003a1.345 1.345 0 0 0-1.036-.486h-.033h.002c-.9.029-1.643.665-1.835 1.51l-.003.013l-.259 1.262c-.008.032-.022.062-.029.094l-.708 3.435h-5.793l.954-4.643a1.4 1.4 0 0 0-.268-1.187l.002.003a1.345 1.345 0 0 0-1.036-.486h-.033h.002c-.9.029-1.643.665-1.835 1.51l-.003.013l-.27 1.313c0 .015-.01.028-.013.042l-.702 3.435H3.547c-.9.029-1.643.664-1.836 1.509l-.003.013a1.4 1.4 0 0 0 .267 1.188l-.002-.003c.248.298.619.487 1.035.487h.034h-.002h3.597l-1.022 4.97H1.864c-.9.029-1.643.665-1.836 1.51l-.003.013a1.404 1.404 0 0 0 .267 1.185L.29 17.18c.249.298.62.487 1.036.487h.034h-.002h3.597l-.96 4.668a1.4 1.4 0 0 0 .268 1.187l-.002-.003c.249.298.62.487 1.036.487h.033h-.002a1.947 1.947 0 0 0 1.836-1.51l.003-.013l.99-4.814h5.796l-.96 4.668a1.4 1.4 0 0 0 .268 1.187l-.002-.003c.249.298.62.486 1.036.486h.033h-.002a1.945 1.945 0 0 0 1.835-1.51l.003-.013l.99-4.814h3.6a1.947 1.947 0 0 0 1.836-1.509l.003-.013a1.388 1.388 0 0 0-.263-1.188l.002.003a1.348 1.348 0 0 0-1.037-.487h-.036h.002h-3.447l1.022-4.97h3.6a1.947 1.947 0 0 0 1.836-1.51l.003-.013a1.401 1.401 0 0 0-.268-1.188l.002.003zM8.819 14.472l1.022-4.97h5.796l-1.022 4.97z" />',
		height: 24,
	},
	lock: {
		svg: '<path d="M418.4 232.7h-23.3v-93.1C395.1 62.5 332.6 0 255.5 0S115.9 62.5 115.9 139.6v93.1H92.6c-12.8 0-23.3 10.4-23.3 23.3v232.7c0 12.9 10.4 23.3 23.3 23.3h325.8c12.8 0 23.3-10.4 23.3-23.3V256c0-12.9-10.5-23.3-23.3-23.3m-69.8 0H162.4v-93.1c0-51.4 41.7-93.1 93.1-93.1s93.1 41.7 93.1 93.1z" />',
		height: 512,
	},
	note: {
		svg: '<path d="M24 4C15.992 4 9.5 10.492 9.5 18.5c0 4.235 1.817 8.047 4.71 10.696c.448.41.748.873.87 1.349l1.27 4.955h15.3l1.27-4.955c.122-.476.422-.938.87-1.35A14.47 14.47 0 0 0 38.5 18.5C38.5 10.492 32.008 4 24 4m7.008 34H16.992l.623 2.43a4.75 4.75 0 0 0 4.6 3.57h3.57a4.75 4.75 0 0 0 4.6-3.57z"/>',
		height: 48,
	},
	star: {
		svg: '<path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256l4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73l3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356l-.83 4.73zm4.905-2.767l-3.686 1.894l.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575l-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957l-3.686-1.894a.5.5 0 0 0-.461 0z" />',
		height: 16,
	},
	unlock: {
		svg: '<path d="M418.9 232.7h-256v-93.1c0-51.4 41.7-93.1 93.1-93.1s93.1 41.7 93.1 93.1v23.3h46.5v-23.3C395.6 62.5 333.1 0 256 0S116.4 62.5 116.4 139.6v93.1H93.1c-12.8 0-23.3 10.4-23.3 23.3v232.7c0 12.9 10.4 23.3 23.3 23.3h325.8c12.8 0 23.3-10.4 23.3-23.3V256c0-12.9-10.4-23.3-23.3-23.3" />',
		height: 512,
	},
	warning: {
		svg: '<path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2a1 1 0 0 1 0-2" />',
		height: 16,
	},
};

export function getSvgIcon(icon: string, indent_count = 1): string {
	const { svg, height } = svgIconMap[icon] ?? { svg: '', height: 0 };
	const svgOpenTag = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${height} ${height}" stroke="currentColor" fill="currentColor" style="stroke-width: 0; padding: 0;">`;
	const svgCloseTag = '</svg>';
	const indent = Array.from({ length: indent_count }, (_, i) => i)
		.map(() => '\t')
		.join('');
	return `\n${indent}${svgOpenTag}\n${indent}\t${svg}\n${indent}${svgCloseTag}\n`;
}
