import type { SvgIconMap } from './types';

export const CODE_FENCE_START_REGEX =
	/```(?<lang>[\w-]+)(?:\s{)?(?:(?<linenos>linenos)=table)?(?:,)?(?:linenostart=(?<start1>[\d]+)|hl_lines=\[(?<highlight1>.+)\])?(?:,)?(?:hl_lines=\[(?<highlight2>.+)\]|linenostart=(?<start2>[\d]+))?(?:})?/g;

export const CODE_FENCE_END_REGEX = /\n```\n/g;
export const INFO_BOX_REGEX = /{{< info_box >}}(?:\s)?(?:<p>)?([\s\S][^{]*)(?:<\/p>)?(?:\s)?{{< \/info_box >}}/g;
export const WARNING_BOX_REGEX = /{{< alert_box >}}(?:\s)?(?:<p>)?([\s\S][^{]*)(?:\s)?(?:<p>)?{{< \/alert_box >}}/g;
export const LINKED_IMAGE_REGEX = /{{< linked_image (?<name>.+) >}}/g;

export const VIDEO_REGEX =
	/{{< autoplay_video video="(?<video>[\w]+)"(?: device="(?<device>mobile|desktop)")?(?: width="(?<width>[\d]+)px")? >}}/g;

export const HTML_HEADING_REGEX = /<h(?<level>2|3|4|5|6) id="(?<slug>[0-9a-z-_]+)">(?<text>.+)<\/(?:h2|h3|h4|h5|h6)>/g;
export const TOX_TEST_RESULTS_REGEX = /test session starts [=]{50,50}([\s\S][^=]*)[=]+/g;

export const CODE_BLOCK_START_REGEX =
	/<pre(?: class="(?<shiki>shiki)" style="background-color: (?<bgColor>#[A-Fa-f0-9]{6,6})")?>?(?:<code(?:>)?)?/g;

export const CODE_BLOCK_END_REGEX = /<\/pre>/g;
export const FA_BULLET_LIST_REGEX = /<div class="fa-bullet-list">/g;

export const FA_BULLET_REGEX =
	/<p class="fa-bullet-list-item(?: complete)?(?: in-progress)?"><span class="fa (?<star>(?:fa-star)(?:-o)?(?:-half-o)?) fa-bullet-icon"><\/span>(?<text>.+)<\/p>/g;

const svgIconMap: SvgIconMap = {
	copy: {
		svg: '<path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"></path>',
		height: 448,
	},
	fullStar: {
		svg: '<path d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"></path>',
		height: 576,
	},
	halfStar: {
		svg: '<path d="M508.55 171.51L362.18 150.2 296.77 17.81C290.89 5.98 279.42 0 267.95 0c-11.4 0-22.79 5.9-28.69 17.81l-65.43 132.38-146.38 21.29c-26.25 3.8-36.77 36.09-17.74 54.59l105.89 103-25.06 145.48C86.98 495.33 103.57 512 122.15 512c4.93 0 10-1.17 14.87-3.75l130.95-68.68 130.94 68.7c4.86 2.55 9.92 3.71 14.83 3.71 18.6 0 35.22-16.61 31.66-37.4l-25.03-145.49 105.91-102.98c19.04-18.5 8.52-50.8-17.73-54.6zm-121.74 123.2l-18.12 17.62 4.28 24.88 19.52 113.45-102.13-53.59-22.38-11.74.03-317.19 51.03 103.29 11.18 22.63 25.01 3.64 114.23 16.63-82.65 80.38z"></path>',
		height: 576,
	},
	hash: {
		svg: '<path d="M440.667 182.109l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l14.623-81.891C377.123 38.754 371.468 32 363.997 32h-40.632a12 12 0 0 0-11.813 9.891L296.175 128H197.54l14.623-81.891C213.477 38.754 207.822 32 200.35 32h-40.632a12 12 0 0 0-11.813 9.891L132.528 128H53.432a12 12 0 0 0-11.813 9.891l-7.143 40C33.163 185.246 38.818 192 46.289 192h74.81L98.242 320H19.146a12 12 0 0 0-11.813 9.891l-7.143 40C-1.123 377.246 4.532 384 12.003 384h74.81L72.19 465.891C70.877 473.246 76.532 480 84.003 480h40.632a12 12 0 0 0 11.813-9.891L151.826 384h98.634l-14.623 81.891C234.523 473.246 240.178 480 247.65 480h40.632a12 12 0 0 0 11.813-9.891L315.472 384h79.096a12 12 0 0 0 11.813-9.891l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l22.857-128h79.096a12 12 0 0 0 11.813-9.891zM261.889 320h-98.634l22.857-128h98.634l-22.857 128z" />',
		height: 448,
	},
	note: {
		svg: '<path d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z" />',
		height: 352,
	},
	star: {
		svg: '<path d="M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"></path>',
		height: 576,
	},
	warning: {
		svg: '<path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"></path>',
		height: 576,
	},
};

export function getSvgIcon(icon: string, indent_count = 1): string {
	const { svg, height } = svgIconMap[icon] ?? { svg: '', height: 0 };
	const svgOpenTag = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${height} 512" stroke="currentColor" fill="currentColor" style="stroke-width: 0; padding: 0;">`;
	const svgCloseTag = '</svg>';
	const indent = Array.from({ length: indent_count }, (_, i) => i)
		.map(() => '\t')
		.join('');
	return `\n${indent}${svgOpenTag}\n${indent}\t${svg}\n${indent}${svgCloseTag}\n`;
}
